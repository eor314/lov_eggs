import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
import os


def list2subdf(path_to_file, orig_df):
    """
    reads in a list of image ids returns a subset of dataframe
    :param path_to_file: absolute path to list of image ids
    :param orig_df: dataframe containing original ROI metadata from EcoTaxa
    :return: subset of df
    """
    with open(path_to_file, 'r') as ff:
        tmp = list(ff)
        ff.close()

    tmp = [line.split('.')[0] for line in tmp]

    return orig_df[orig_df['object_original_objid'].isin(tmp)]


# import data from the tsv file
copes = pd.read_table(r'D:\LOV\all_copepoda.tsv', header=0)
#copes = pd.read_table('/Users/eorenstein/Documents/eggs-data/all_copepoda.tsv', header=0)
copes['object_length_mm'] = copes['object_major']*copes['sample_pixel']  #fill in the major object length in mm

# Do the same for the eggs
eggs = pd.read_table(r'D:\LOV\all_eggs.tsv', header=0)
#eggs = pd.read_table('/Users/eorenstein/Documents/eggs-data/all_eggs.tsv', header=0)
eggs['object_length_mm'] = eggs['object_major']*eggs['sample_pixel']  #fill in the major object length in mm

# positive == eggs, negative == copepod
ptf = r'D:/LOV/resnet18_1613491390_model_conv_1613494049'

t_neg = list2subdf(os.path.join(ptf, 'copepod', 'copepod.txt'), copes)
f_pos = list2subdf(os.path.join(ptf, 'copepod', 'egg.txt'), copes)

t_pos = list2subdf(os.path.join(ptf, 'egg', 'egg.txt'), eggs)
f_neg = list2subdf(os.path.join(ptf, 'egg', 'copepod.txt'), eggs)

# look at the profiles represent the true pos and false neg
t_pos_profs = t_pos['sample_original_sampleid'].value_counts()
f_neg_profs = f_neg['sample_original_sampleid'].value_counts()

t_neg_profs = t_neg['sample_original_sampleid'].value_counts()
f_pos_profs = f_pos['sample_original_sampleid'].value_counts()
